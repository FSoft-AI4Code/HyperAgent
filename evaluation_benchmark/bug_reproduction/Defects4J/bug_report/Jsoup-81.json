{"issue_id": "1009", "title": "Failure to guess correct XHTML encoding even when explicitly declared", "description": "\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='String encoding = \"iso-8859-1\";\nInputStream soup = new ByteArrayInputStream((\n    \"&lt;?xml version=\\\"1.0\\\" encoding=\\\"\" + encoding + \"\\\"?&gt;\" +\n    \"&lt;!DOCTYPE html PUBLIC \\\"-//W3C//DTD XHTML 1.0 Strict//EN\\\" \\\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\\\"&gt;\" +\n    \"&lt;html xmlns=\\\"http://www.w3.org/1999/xhtml\\\" lang=\\\"en\\\" xml:lang=\\\"en\\\"&gt;Hell\u00f6 W\u00f6rld!&lt;/html&gt;\"\n    ).getBytes(encoding));\n\nSystem.out.println(Jsoup.parse(soup, null, \"\"));'><pre class=\"notranslate\"><code>String encoding = \"iso-8859-1\";\nInputStream soup = new ByteArrayInputStream((\n    \"&lt;?xml version=\\\"1.0\\\" encoding=\\\"\" + encoding + \"\\\"?&gt;\" +\n    \"&lt;!DOCTYPE html PUBLIC \\\"-//W3C//DTD XHTML 1.0 Strict//EN\\\" \\\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\\\"&gt;\" +\n    \"&lt;html xmlns=\\\"http://www.w3.org/1999/xhtml\\\" lang=\\\"en\\\" xml:lang=\\\"en\\\"&gt;Hell\u00f6 W\u00f6rld!&lt;/html&gt;\"\n    ).getBytes(encoding));\n\nSystem.out.println(Jsoup.parse(soup, null, \"\"));\n</code></pre></div>\n<p dir=\"auto\">prints:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='&lt;!--?xml version=\"1.0\" encoding=\"iso-8859-1\"?--&gt;&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\"&gt;\n&lt;html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\" xml:lang=\"en\"&gt;\n &lt;head&gt;&lt;/head&gt;\n &lt;body&gt;\n  Hell\ufffd W\ufffdrld!\n &lt;/body&gt;\n&lt;/html&gt;'><pre class=\"notranslate\"><code>&lt;!--?xml version=\"1.0\" encoding=\"iso-8859-1\"?--&gt;&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\"&gt;\n&lt;html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\" xml:lang=\"en\"&gt;\n &lt;head&gt;&lt;/head&gt;\n &lt;body&gt;\n  Hell\ufffd W\ufffdrld!\n &lt;/body&gt;\n&lt;/html&gt;\n</code></pre></div>\n<p dir=\"auto\">instead of expected output:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='&lt;!--?xml version=\"1.0\" encoding=\"iso-8859-1\"?--&gt;&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\"&gt;\n&lt;html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\" xml:lang=\"en\"&gt;\n &lt;head&gt;&lt;/head&gt;\n &lt;body&gt;\n  Hell\u00f6 W\u00f6rld!\n &lt;/body&gt;\n&lt;/html&gt;'><pre class=\"notranslate\"><code>&lt;!--?xml version=\"1.0\" encoding=\"iso-8859-1\"?--&gt;&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\"&gt;\n&lt;html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\" xml:lang=\"en\"&gt;\n &lt;head&gt;&lt;/head&gt;\n &lt;body&gt;\n  Hell\u00f6 W\u00f6rld!\n &lt;/body&gt;\n&lt;/html&gt;\n</code></pre></div>\n"}