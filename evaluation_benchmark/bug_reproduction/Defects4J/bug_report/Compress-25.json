{"issue_id": "COMPRESS-264", "title": "ZIP reads correctly with commons-compress 1.6, gives NUL bytes in 1.7", "description": "\n<div class=\"user-content-block\">\n<p>When running the code below, commons-compress 1.6 writes:</p>\n<p> Content of test.txt:<br/>\n data</p>\n<p>By comparison, commons-compress 1.7 writes</p>\n<p> Content of test.txt:<br/>\n<sup>@</sup>@<sup>@</sup>@^@</p>\n<p>package com.example.jrn;<br/>\nimport org.apache.commons.compress.archivers.zip.ZipArchiveEntry;<br/>\nimport org.apache.commons.compress.archivers.zip.ZipArchiveInputStream;<br/>\nimport java.io.ByteArrayInputStream;<br/>\nimport java.io.IOException;<br/>\nimport java.lang.System;<br/>\n/**</p>\n<ul>\n<li>Hello world!<br/>\n *<br/>\n */<br/>\npublic class App {<br/>\n  public static void main(String[] args) {<br/>\n    byte[] zip = \n{\n       (byte)0x50, (byte)0x4b, (byte)0x03, (byte)0x04, (byte)0x0a, (byte)0x00,\n       (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x03, (byte)0x7b,\n       (byte)0xd1, (byte)0x42, (byte)0x82, (byte)0xc5, (byte)0xc1, (byte)0xe6,\n       (byte)0x05, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x05, (byte)0x00,\n       (byte)0x00, (byte)0x00, (byte)0x08, (byte)0x00, (byte)0x1c, (byte)0x00,\n       (byte)0x74, (byte)0x65, (byte)0x73, (byte)0x74, (byte)0x2e, (byte)0x74,\n       (byte)0x78, (byte)0x74, (byte)0x55, (byte)0x54, (byte)0x09, (byte)0x00,\n       (byte)0x03, (byte)0x56, (byte)0x62, (byte)0xbf, (byte)0x51, (byte)0x2a,\n       (byte)0x63, (byte)0xbf, (byte)0x51, (byte)0x75, (byte)0x78, (byte)0x0b,\n       (byte)0x00, (byte)0x01, (byte)0x04, (byte)0x01, (byte)0xff, (byte)0x01,\n       (byte)0x00, (byte)0x04, (byte)0x88, (byte)0x13, (byte)0x00, (byte)0x00,\n       (byte)0x64, (byte)0x61, (byte)0x74, (byte)0x61, (byte)0x0a, (byte)0x50,\n       (byte)0x4b, (byte)0x01, (byte)0x02, (byte)0x1e, (byte)0x03, (byte)0x0a,\n       (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x03,\n       (byte)0x7b, (byte)0xd1, (byte)0x42, (byte)0x82, (byte)0xc5, (byte)0xc1,\n       (byte)0xe6, (byte)0x05, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x05,\n       (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x08, (byte)0x00, (byte)0x18,\n       (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x01,\n       (byte)0x00, (byte)0x00, (byte)0x00, (byte)0xa0, (byte)0x81, (byte)0x00,\n       (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x74, (byte)0x65, (byte)0x73,\n       (byte)0x74, (byte)0x2e, (byte)0x74, (byte)0x78, (byte)0x74, (byte)0x55,\n       (byte)0x54, (byte)0x05, (byte)0x00, (byte)0x03, (byte)0x56, (byte)0x62,\n       (byte)0xbf, (byte)0x51, (byte)0x75, (byte)0x78, (byte)0x0b, (byte)0x00,\n       (byte)0x01, (byte)0x04, (byte)0x01, (byte)0xff, (byte)0x01, (byte)0x00,\n       (byte)0x04, (byte)0x88, (byte)0x13, (byte)0x00, (byte)0x00, (byte)0x50,\n       (byte)0x4b, (byte)0x05, (byte)0x06, (byte)0x00, (byte)0x00, (byte)0x00,\n       (byte)0x00, (byte)0x01, (byte)0x00, (byte)0x01, (byte)0x00, (byte)0x4e,\n       (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x47, (byte)0x00, (byte)0x00,\n       (byte)0x00, (byte)0x00, (byte)00\n    }\n<p>;</p></li>\n</ul>\n<p>    ByteArrayInputStream bin = new ByteArrayInputStream(zip);<br/>\n    try {<br/>\n      ZipArchiveInputStream in = new ZipArchiveInputStream(bin);<br/>\n      try {<br/>\n        while (true) {<br/>\n          ZipArchiveEntry entry = in.getNextZipEntry();<br/>\n          if (entry == null) </p>\n{\n            break;\n          }\n<p>          byte[] buf = new byte<span class=\"error\">[(int) entry.getSize()]</span>;<br/>\n          in.read(buf);<br/>\n          System.out.println(\"Content of \" + entry.getName() + \":\");<br/>\n          System.out.write(buf);<br/>\n        }<br/>\n      } finally </p>\n{\n        in.close();\n      }\n<p>    } catch (IOException e) </p>\n{\n      System.err.println(\"IOException: \" + e);\n    }\n<p>  }<br/>\n}</p>\n</div>\n"}