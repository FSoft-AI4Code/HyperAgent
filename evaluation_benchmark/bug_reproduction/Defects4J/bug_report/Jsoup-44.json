{"issue_id": "552", "title": "Unexpected elements inside table are moved to wrong location", "description": "\n<p dir=\"auto\">This commit <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/jhy/jsoup/commit/e99193605b688e923d20054c13db897cff751607/hovercard\" href=\"https://github.com/jhy/jsoup/commit/e99193605b688e923d20054c13db897cff751607\"><tt>e991936</tt></a> introduced a bug where handling of unexpected elements inside a table element changed, resulting in the unexpected elements being pushed further up the document than before.</p>\n<p dir=\"auto\">I have constructed a minimal repro. Before the commit in question, the unexpected p tag would continue to be positioned after the comment (with some elements being closed early etc. to support this). After the commit, the p tag and its contents are moved up more than one table level, and now appear after the comment tag.</p>\n<p dir=\"auto\">Obviously this input HTML is very broken and bad, but it seems that the change in behaviour was unintended.</p>\n<p dir=\"auto\">copying <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/jaredstehler/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jaredstehler\">@jaredstehler</a></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='@Test\npublic void testInvalidTableContents() throws IOException {\n    File in = getFile(\"/htmltests/table-invalid-elements.html\");\n    Document doc = Jsoup.parse(in, \"UTF-8\");\n    doc.outputSettings().prettyPrint(true);\n    String rendered = doc.toString();\n    int endOfEmail = rendered.indexOf(\"Comment\");\n    int guarantee = rendered.indexOf(\"Why am I here?\");\n    assertTrue(\"Comment not found\", endOfEmail &gt; -1);\n    assertTrue(\"Search text not found\", guarantee &gt; -1);\n    assertTrue(\"Search text did not come after comment\", guarantee &gt; endOfEmail);\n}'><pre class=\"notranslate\"><code>@Test\npublic void testInvalidTableContents() throws IOException {\n    File in = getFile(\"/htmltests/table-invalid-elements.html\");\n    Document doc = Jsoup.parse(in, \"UTF-8\");\n    doc.outputSettings().prettyPrint(true);\n    String rendered = doc.toString();\n    int endOfEmail = rendered.indexOf(\"Comment\");\n    int guarantee = rendered.indexOf(\"Why am I here?\");\n    assertTrue(\"Comment not found\", endOfEmail &gt; -1);\n    assertTrue(\"Search text not found\", guarantee &gt; -1);\n    assertTrue(\"Search text did not come after comment\", guarantee &gt; endOfEmail);\n}\n</code></pre></div>\n<p dir=\"auto\">Uses the following fixture:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&lt;html&gt;\n    &lt;body&gt;\n        &lt;table&gt;\n            &lt;tr&gt;\n                &lt;td&gt;\n                    &lt;table&gt;\n                        &lt;tr&gt;\n                            &lt;!--Comment--&gt;\n                            &lt;table&gt;\n                                &lt;p&gt;Why am I here?&lt;/p&gt;\n                        &lt;/tr&gt;\n                    &lt;/table&gt;\n                &lt;/td&gt;\n            &lt;/tr&gt;\n        &lt;/table&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\"><pre class=\"notranslate\"><code>&lt;html&gt;\n    &lt;body&gt;\n        &lt;table&gt;\n            &lt;tr&gt;\n                &lt;td&gt;\n                    &lt;table&gt;\n                        &lt;tr&gt;\n                            &lt;!--Comment--&gt;\n                            &lt;table&gt;\n                                &lt;p&gt;Why am I here?&lt;/p&gt;\n                        &lt;/tr&gt;\n                    &lt;/table&gt;\n                &lt;/td&gt;\n            &lt;/tr&gt;\n        &lt;/table&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre></div>\n"}