{"issue_id": "1013", "title": "Bug when skipping a value while using the JsonTreeReader", "description": "\n<p dir=\"auto\">When using a <code class=\"notranslate\">JsonReader</code> to read a JSON object, <code class=\"notranslate\">skipValue()</code> skips the structure successfully.</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='@Test\npublic void testSkipValue_JsonReader() throws IOException {\n  try (JsonReader in = new JsonReader(new StringReader(\"{}\"))) {\n    in.skipValue();\n  }\n}'><pre><span class=\"pl-c1\">@</span><span class=\"pl-c1\">Test</span>\n<span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">testSkipValue_JsonReader</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-c1\">IOException</span> {\n  <span class=\"pl-k\">try</span> (<span class=\"pl-smi\">JsonReader</span> <span class=\"pl-s1\">in</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">JsonReader</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">StringReader</span>(<span class=\"pl-s\">\"{}\"</span>))) {\n    <span class=\"pl-s1\">in</span>.<span class=\"pl-en\">skipValue</span>();\n  }\n}</pre></div>\n<p dir=\"auto\">But when using a <code class=\"notranslate\">JsonTreeReader</code> to read a JSON object, <code class=\"notranslate\">skipValue()</code> throws a <code class=\"notranslate\">ArrayIndexOutOfBoundsException</code>.</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"@Test\npublic void testSkipValue_JsonTreeReader() throws IOException {\n  try (JsonTreeReader in = new JsonTreeReader(new JsonObject())) {\n    in.skipValue();\n  }\n}\"><pre><span class=\"pl-c1\">@</span><span class=\"pl-c1\">Test</span>\n<span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">testSkipValue_JsonTreeReader</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-c1\">IOException</span> {\n  <span class=\"pl-k\">try</span> (<span class=\"pl-smi\">JsonTreeReader</span> <span class=\"pl-s1\">in</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">JsonTreeReader</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">JsonObject</span>())) {\n    <span class=\"pl-s1\">in</span>.<span class=\"pl-en\">skipValue</span>();\n  }\n}</pre></div>\n<p dir=\"auto\">Stacktrace</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.lang.ArrayIndexOutOfBoundsException: -1\n\tat com.google.gson.internal.bind.JsonTreeReader.skipValue(JsonTreeReader.java:262)\"><pre class=\"notranslate\"><code>java.lang.ArrayIndexOutOfBoundsException: -1\n\tat com.google.gson.internal.bind.JsonTreeReader.skipValue(JsonTreeReader.java:262)\n</code></pre></div>\n<p dir=\"auto\">The method <code class=\"notranslate\">popStack()</code> is being called on line 261 with a <code class=\"notranslate\">stackSize</code> of <code class=\"notranslate\">1</code> and afterwards the <code class=\"notranslate\">stackSize</code> is <code class=\"notranslate\">0</code> and the call on line 262 must result in an <code class=\"notranslate\">ArrayIndexOutOfBoundsException</code>.</p>\n"}