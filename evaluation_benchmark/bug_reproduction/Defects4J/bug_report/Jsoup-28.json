{"issue_id": "224", "title": "Jsoup.parse unescapes query params in plain text URL's", "description": "\n<p dir=\"auto\">I'm trying to clean the HTML snippet below, but unfortunately the URL parameter names have been mistaken for HTML entities and unescaped to HTML.</p>\n<div class=\"highlight highlight-text-html-basic notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='    &lt;a href=\"http://www.foo.com?a=1&amp;num_rooms=1&amp;children=0&amp;int=VA&amp;b=2\"&gt;\n        http://www.foo.com?a=1&amp;num_rooms=1&amp;children=0&amp;int=VA&amp;b=2\n    &lt;/a&gt;'><pre>    <span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">a</span> <span class=\"pl-c1\">href</span>=\"<span class=\"pl-s\">http://www.foo.com?a=1&amp;num_rooms=1&amp;children=0&amp;int=VA&amp;b=2</span>\"<span class=\"pl-kos\">&gt;</span>\n        http://www.foo.com?a=1&amp;num_rooms=1&amp;children=0&amp;int=VA&amp;b=2\n    <span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">a</span><span class=\"pl-kos\">&gt;</span></pre></div>\n<p dir=\"auto\">Cleaned HTML:    <a href=\"http://www.foo.com?a=1#_rooms=1%CF%87ldren=0%E2%88%AB=VA&amp;amp;b=2\" rel=\"nofollow\">http://www.foo.com?a=1#_rooms=1\u03c7ldren=0\u222b=VA&amp;amp;b=2</a><br/>\nExpected HTML: <a href=\"http://www.foo.com?a=1&amp;num_rooms=1&amp;children=0&amp;int=VA&amp;b=2\" rel=\"nofollow\">http://www.foo.com?a=1&amp;num_rooms=1&amp;children=0&amp;int=VA&amp;b=2</a></p>\n<p dir=\"auto\">Unit tests...</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='    private static final String URL = \"http://www.foo.com?a=1&amp;num_rooms=1&amp;children=0&amp;int=VA&amp;b=2\";\n\n    /**\n     * Passes\n     */\n    @Test\n    public void testStringEscapeUtilsUnescapeHtml() throws Exception {\n        // org.apache.commons.lang.StringEscapeUtils;\n        assertEquals(URL, StringEscapeUtils.unescapeHtml(URL));\n    }\n\n    /**\n     * Fails: unescapes &amp;num, &amp;chi, and &amp;int to #, \u03c7, and \u222b respectively\n     * Expected :http://www.foo.com?a=1&amp;num_rooms=1&amp;children=0&amp;int=VA&amp;b=2\n     * Actual   :http://www.foo.com?a=1#_rooms=1\u03c7ldren=0\u222b=VA&amp;amp;b=2\n     */\n    @Test\n    public void testJsoupClean() throws Exception {\n        String html = \"&lt;a href=\\\"\" + URL + \"\\\"&gt;\" + URL + \"&lt;/a&gt;\";\n        assertEquals(URL, Jsoup.clean(html, Whitelist.none()));\n    }\n\n    /**\n     * Fails: unescapes &amp;num, &amp;chi, and &amp;int to #, \u03c7, and \u222b respectively\n     * Expected :http://www.foo.com?a=1&amp;num_rooms=1&amp;children=0&amp;int=VA&amp;b=2\n     * Actual   :http://www.foo.com?a=1#_rooms=1&amp;children=0\u222b=VA&amp;b=2\n     */\n    @Test\n    public void testJsoupTextNodeCreateFromEncoded() throws Exception {\n        assertEquals(URL, TextNode.createFromEncoded(URL, null).text());\n    }'><pre>    <span class=\"pl-k\">private</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-c1\">URL</span> = <span class=\"pl-s\">\"http://www.foo.com?a=1&amp;num_rooms=1&amp;children=0&amp;int=VA&amp;b=2\"</span>;\n\n    <span class=\"pl-c\">/**</span>\n<span class=\"pl-c\">     * Passes</span>\n<span class=\"pl-c\">     */</span>\n    <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Test</span>\n    <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">testStringEscapeUtilsUnescapeHtml</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-s1\">Exception</span> {\n        <span class=\"pl-c\">// org.apache.commons.lang.StringEscapeUtils;</span>\n        <span class=\"pl-en\">assertEquals</span>(<span class=\"pl-c1\">URL</span>, <span class=\"pl-s1\">StringEscapeUtils</span>.<span class=\"pl-en\">unescapeHtml</span>(<span class=\"pl-c1\">URL</span>));\n    }\n\n    <span class=\"pl-c\">/**</span>\n<span class=\"pl-c\">     * Fails: unescapes &amp;num, &amp;chi, and &amp;int to #, \u03c7, and \u222b respectively</span>\n<span class=\"pl-c\">     * Expected :http://www.foo.com?a=1&amp;num_rooms=1&amp;children=0&amp;int=VA&amp;b=2</span>\n<span class=\"pl-c\">     * Actual   :http://www.foo.com?a=1#_rooms=1\u03c7ldren=0\u222b=VA&amp;amp;b=2</span>\n<span class=\"pl-c\">     */</span>\n    <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Test</span>\n    <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">testJsoupClean</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-s1\">Exception</span> {\n        <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">html</span> = <span class=\"pl-s\">\"&lt;a href=\\\"\"</span> + <span class=\"pl-c1\">URL</span> + <span class=\"pl-s\">\"\\\"&gt;\"</span> + <span class=\"pl-c1\">URL</span> + <span class=\"pl-s\">\"&lt;/a&gt;\"</span>;\n        <span class=\"pl-en\">assertEquals</span>(<span class=\"pl-c1\">URL</span>, <span class=\"pl-s1\">Jsoup</span>.<span class=\"pl-en\">clean</span>(<span class=\"pl-s1\">html</span>, <span class=\"pl-s1\">Whitelist</span>.<span class=\"pl-en\">none</span>()));\n    }\n\n    <span class=\"pl-c\">/**</span>\n<span class=\"pl-c\">     * Fails: unescapes &amp;num, &amp;chi, and &amp;int to #, \u03c7, and \u222b respectively</span>\n<span class=\"pl-c\">     * Expected :http://www.foo.com?a=1&amp;num_rooms=1&amp;children=0&amp;int=VA&amp;b=2</span>\n<span class=\"pl-c\">     * Actual   :http://www.foo.com?a=1#_rooms=1&amp;children=0\u222b=VA&amp;b=2</span>\n<span class=\"pl-c\">     */</span>\n    <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Test</span>\n    <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">testJsoupTextNodeCreateFromEncoded</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-s1\">Exception</span> {\n        <span class=\"pl-en\">assertEquals</span>(<span class=\"pl-c1\">URL</span>, <span class=\"pl-s1\">TextNode</span>.<span class=\"pl-en\">createFromEncoded</span>(<span class=\"pl-c1\">URL</span>, <span class=\"pl-c1\">null</span>).<span class=\"pl-en\">text</span>());\n    }</pre></div>\n"}