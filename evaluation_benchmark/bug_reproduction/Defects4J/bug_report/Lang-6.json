{"issue_id": "LANG-857", "title": "StringIndexOutOfBoundsException in CharSequenceTranslator", "description": "\n<div class=\"user-content-block\">\n<p>I found that there is bad surrogate pair handling in the CharSequenceTranslator</p>\n<p>This is a simple test case for this problem.<br/>\n\\uD83D\\uDE30 is a surrogate pair.</p>\n<div class=\"code panel\" style=\"border-width: 1px;\"><div class=\"codeContent panelContent\">\n<pre class=\"code-java\">@Test\n<span class=\"code-keyword\">public</span> void testEscapeSurrogatePairs() <span class=\"code-keyword\">throws</span> Exception {\n    assertEquals(<span class=\"code-quote\">\"\\uD83D\\uDE30\"</span>, StringEscapeUtils.escapeCsv(<span class=\"code-quote\">\"\\uD83D\\uDE30\"</span>));\n}\n</pre>\n</div></div>\n<p>You'll get the exception as shown below.</p>\n<div class=\"code panel\" style=\"border-width: 1px;\"><div class=\"codeContent panelContent\">\n<pre class=\"code-java\">java.lang.StringIndexOutOfBoundsException: <span class=\"code-object\">String</span> index out of range: 2\n\tat java.lang.<span class=\"code-object\">String</span>.charAt(<span class=\"code-object\">String</span>.java:658)\n\tat java.lang.<span class=\"code-object\">Character</span>.codePointAt(<span class=\"code-object\">Character</span>.java:4668)\n\tat org.apache.commons.lang3.text.translate.CharSequenceTranslator.translate(CharSequenceTranslator.java:95)\n\tat org.apache.commons.lang3.text.translate.CharSequenceTranslator.translate(CharSequenceTranslator.java:59)\n\tat org.apache.commons.lang3.StringEscapeUtils.escapeCsv(StringEscapeUtils.java:556)\n</pre>\n</div></div>\n<p>Patch attached, the method affected:</p>\n<ol>\n<li>public final void translate(CharSequence input, Writer out) throws IOException</li>\n</ol>\n</div>\n"}