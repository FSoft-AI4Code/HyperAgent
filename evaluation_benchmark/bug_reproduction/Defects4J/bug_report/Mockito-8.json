{"issue_id": "114", "title": "1.10 regression (StackOverflowError) with interface where generic type has itself as upper bound", "description": "\n<p dir=\"auto\">Add this to <code class=\"notranslate\">GenericMetadataSupportTest</code>:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='    interface GenericsSelfReference&lt;T extends GenericsSelfReference&lt;T&gt;&gt; {\n        T self();\n    }\n\n    @Test\n    public void typeVariable_of_self_type() {\n        GenericMetadataSupport genericMetadata = inferFrom(GenericsSelfReference.class).resolveGenericReturnType(firstNamedMethod(\"self\", GenericsSelfReference.class));\n\n        assertThat(genericMetadata.rawType()).isEqualTo(GenericsSelfReference.class);\n    }'><pre>    <span class=\"pl-k\">interface</span> <span class=\"pl-smi\">GenericsSelfReference</span>&lt;<span class=\"pl-s1\">T</span> <span class=\"pl-k\">extends</span> <span class=\"pl-smi\">GenericsSelfReference</span>&lt;<span class=\"pl-smi\">T</span>&gt;&gt; {\n        <span class=\"pl-smi\">T</span> <span class=\"pl-en\">self</span>();\n    }\n\n    <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Test</span>\n    <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">typeVariable_of_self_type</span>() {\n        <span class=\"pl-smi\">GenericMetadataSupport</span> <span class=\"pl-s1\">genericMetadata</span> = <span class=\"pl-en\">inferFrom</span>(<span class=\"pl-smi\">GenericsSelfReference</span>.<span class=\"pl-s1\">class</span>).<span class=\"pl-en\">resolveGenericReturnType</span>(<span class=\"pl-en\">firstNamedMethod</span>(<span class=\"pl-s\">\"self\"</span>, <span class=\"pl-smi\">GenericsSelfReference</span>.<span class=\"pl-s1\">class</span>));\n\n        <span class=\"pl-en\">assertThat</span>(<span class=\"pl-s1\">genericMetadata</span>.<span class=\"pl-en\">rawType</span>()).<span class=\"pl-en\">isEqualTo</span>(<span class=\"pl-smi\">GenericsSelfReference</span>.<span class=\"pl-s1\">class</span>);\n    }</pre></div>\n<p dir=\"auto\">It fails on master and 1.10.8 with this:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.lang.StackOverflowError\n    at sun.reflect.generics.reflectiveObjects.TypeVariableImpl.hashCode(TypeVariableImpl.java:201)\n    at java.util.HashMap.hash(HashMap.java:338)\n    at java.util.HashMap.get(HashMap.java:556)\n    at org.mockito.internal.util.reflection.GenericMetadataSupport.getActualTypeArgumentFor(GenericMetadataSupport.java:193)\n    at org.mockito.internal.util.reflection.GenericMetadataSupport.getActualTypeArgumentFor(GenericMetadataSupport.java:196)\n    at org.mockito.internal.util.reflection.GenericMetadataSupport.getActualTypeArgumentFor(GenericMetadataSupport.java:196)\"><pre class=\"notranslate\"><code>java.lang.StackOverflowError\n    at sun.reflect.generics.reflectiveObjects.TypeVariableImpl.hashCode(TypeVariableImpl.java:201)\n    at java.util.HashMap.hash(HashMap.java:338)\n    at java.util.HashMap.get(HashMap.java:556)\n    at org.mockito.internal.util.reflection.GenericMetadataSupport.getActualTypeArgumentFor(GenericMetadataSupport.java:193)\n    at org.mockito.internal.util.reflection.GenericMetadataSupport.getActualTypeArgumentFor(GenericMetadataSupport.java:196)\n    at org.mockito.internal.util.reflection.GenericMetadataSupport.getActualTypeArgumentFor(GenericMetadataSupport.java:196)\n</code></pre></div>\n<p dir=\"auto\">It worked on 1.9.5. May be caused by the changes in <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/mockito/mockito/commit/ab9e9f347705bf9f4ebace4b07b085088275a256/hovercard\" href=\"https://github.com/mockito/mockito/commit/ab9e9f347705bf9f4ebace4b07b085088275a256\"><tt>ab9e9f3</tt></a> (cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/bric3/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/bric3\">@bric3</a>).</p>\n<p dir=\"auto\">(Also note that while the above interface looks strange, it is commonly used for builder hierarchies, where base class methods want to return this with a more specific type.)</p>\n"}