{"issue_id": "LANG-645", "title": "FastDateFormat.format() outputs incorrect week of year because locale isn't respected", "description": "\n<div class=\"user-content-block\">\n<p>FastDateFormat apparently doesn't respect the locale it was sent on creation when outputting week in year (e.g. \"ww\") in format(). It seems to use the settings of the system locale for firstDayOfWeek and minimalDaysInFirstWeek, which (depending on the year) may result in the incorrect week number being output.</p>\n<p>Here is a simple test program to demonstrate the problem by comparing with SimpleDateFormat, which gets the week number right:</p>\n<div class=\"code panel\" style=\"border-width: 1px;\"><div class=\"codeContent panelContent\">\n<pre class=\"code-java\"><span class=\"code-keyword\">import</span> java.util.Calendar;\n<span class=\"code-keyword\">import</span> java.util.Date;\n<span class=\"code-keyword\">import</span> java.util.Locale;\n<span class=\"code-keyword\">import</span> java.text.SimpleDateFormat;\n\n<span class=\"code-keyword\">import</span> org.apache.commons.lang.time.FastDateFormat;\n\n<span class=\"code-keyword\">public</span> <span class=\"code-keyword\">class </span>FastDateFormatWeekBugDemo {\n    <span class=\"code-keyword\">public</span> <span class=\"code-keyword\">static</span> void main(<span class=\"code-object\">String</span>[] args) {\n        Locale.setDefault(<span class=\"code-keyword\">new</span> Locale(<span class=\"code-quote\">\"en\"</span>, <span class=\"code-quote\">\"US\"</span>));\n        Locale locale = <span class=\"code-keyword\">new</span> Locale(<span class=\"code-quote\">\"sv\"</span>, <span class=\"code-quote\">\"SE\"</span>);\n\n        Calendar cal = Calendar.getInstance(); <span class=\"code-comment\">// setting locale here doesn't change outcome\n</span>        cal.set(2010, 0, 1, 12, 0, 0);\n        Date d = cal.getTime();\n        <span class=\"code-object\">System</span>.out.println(<span class=\"code-quote\">\"Target date: \"</span> + d);\n\n        FastDateFormat fdf = FastDateFormat.getInstance(<span class=\"code-quote\">\"EEEE<span class=\"code-quote\">', week '</span>ww\"</span>, locale);\n        SimpleDateFormat sdf = <span class=\"code-keyword\">new</span> SimpleDateFormat(<span class=\"code-quote\">\"EEEE<span class=\"code-quote\">', week '</span>ww\"</span>, locale);\n        <span class=\"code-object\">System</span>.out.println(<span class=\"code-quote\">\"FastDateFormat:   \"</span> + fdf.format(d)); <span class=\"code-comment\">// will output <span class=\"code-quote\">\"FastDateFormat:   fredag, week 01\"</span>\n</span>        <span class=\"code-object\">System</span>.out.println(<span class=\"code-quote\">\"SimpleDateFormat: \"</span> + sdf.format(d)); <span class=\"code-comment\">// will output <span class=\"code-quote\">\"SimpleDateFormat: fredag, week 53\"</span>\n</span>    }\n}\n</pre>\n</div></div>\n<p>If sv/SE is passed to Locale.setDefault() instead of en/US, both FastDateFormat and SimpleDateFormat output the correct week number.</p>\n</div>\n"}