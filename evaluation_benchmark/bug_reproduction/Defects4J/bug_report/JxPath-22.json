{"issue_id": "JXPATH-154", "title": "Resetting the default namespace causes a serious endless loop when requesting .asPath() on a node.", "description": "\n<div class=\"user-content-block\">\n<p>sample smaller case:</p>\n<div class=\"code panel\" style=\"border-width: 1px;\"><div class=\"codeContent panelContent\">\n<pre class=\"code-java\">&lt;...&gt;\n &lt;b:foo xmlns:b=<span class=\"code-quote\">\"bla\"</span> xmlns=<span class=\"code-quote\">\"test111\"</span>&gt;    &lt;!--  No nodes are placed in the tree within ns <span class=\"code-quote\">\"test111\"</span> but the attribute is still there.--&gt;\n  &lt;b:bar&gt;a&lt;/b:bar&gt;                         &lt;!-- is in ns <span class=\"code-quote\">'bla'</span> --&gt;\n  &lt;test xmlns=\"\"&gt;&lt;/test&gt;                   &lt;!-- does not have a namespace --&gt;\n &lt;/b:foo&gt;\n&lt;/...&gt;\n</pre>\n</div></div>\n<p>when requesting .asPath() on the 'test' node, it loops in org.apache.commons.jxpath.ri.NamespaceResolver.getPrefix(NodePointer, String), <br/>\nand if it didn't loop it would create a wrong xpath '//b:fo/null:test' DOMNodePointer.asPath().</p>\n<p>So I think that the fix should be in org.apache.commons.jxpath.ri.model.dom.DOMNodePointer.asPath()</p>\n<div class=\"code panel\" style=\"border-width: 1px;\"><div class=\"codeContent panelContent\">\n<pre class=\"code-java\">....\n                    <span class=\"code-object\">String</span> ln = DOMNodePointer.getLocalName(node);\n                    <span class=\"code-object\">String</span> nsURI = getNamespaceURI();\n                    <span class=\"code-keyword\">if</span> (nsURI == <span class=\"code-keyword\">null</span>) {\n                        buffer.append(ln);\n                        buffer.append(<span class=\"code-quote\">'['</span>);\n                        buffer.append(getRelativePositionByName()).append(<span class=\"code-quote\">']'</span>);\n                    }\n                    <span class=\"code-keyword\">else</span> {\n                        <span class=\"code-object\">String</span> prefix = getNamespaceResolver().getPrefix(nsURI);\n                        <span class=\"code-keyword\">if</span> (prefix != <span class=\"code-keyword\">null</span>) {\n...\n</pre>\n</div></div>\n<p>should become</p>\n<div class=\"code panel\" style=\"border-width: 1px;\"><div class=\"codeContent panelContent\">\n<pre class=\"code-java\">...\n                    <span class=\"code-object\">String</span> ln = DOMNodePointer.getLocalName(node);\n                    <span class=\"code-object\">String</span> nsURI = getNamespaceURI();\n                    <span class=\"code-keyword\">if</span> (nsURI == <span class=\"code-keyword\">null</span> || nsURI.length() == 0) { <span class=\"code-comment\">// check <span class=\"code-keyword\">for</span> empty string which means that the node doesn't have a namespace.\n</span>                        buffer.append(ln);\n                        buffer.append(<span class=\"code-quote\">'['</span>);\n                        buffer.append(getRelativePositionByName()).append(<span class=\"code-quote\">']'</span>);\n                    }\n                    <span class=\"code-keyword\">else</span> {\n                        <span class=\"code-object\">String</span> prefix = getNamespaceResolver().getPrefix(nsURI);\n                        <span class=\"code-keyword\">if</span> (prefix != <span class=\"code-keyword\">null</span>) {\n...\n</pre>\n</div></div>\n</div>\n"}