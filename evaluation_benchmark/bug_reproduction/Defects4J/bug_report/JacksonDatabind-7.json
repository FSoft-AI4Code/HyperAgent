{"issue_id": "592", "title": "Possibly wrong <code>TokenBuffer</code> delegate deserialization using <code>@JsonCreator</code>", "description": "\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"class Value {\n@JsonCreator\npublic static Value from(TokenBuffer buffer) {\n...\n}\"><pre><span class=\"pl-k\">class</span> <span class=\"pl-smi\">Value</span> {\n<span class=\"pl-c1\">@</span><span class=\"pl-c1\">JsonCreator</span>\n<span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">Value</span> <span class=\"pl-en\">from</span>(<span class=\"pl-smi\">TokenBuffer</span> <span class=\"pl-s1\">buffer</span>) {\n...\n}</pre></div>\n<p dir=\"auto\">Given JSON string is  <code class=\"notranslate\">{ \"a\":1, \"b\":null }</code>, it is expected that while deserializing using delegate buffer,<br/>\ncurrent token will be start object <code class=\"notranslate\">{</code>, and rest of the tokens will be available in buffer:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[START_OBJECT, FIELD_NAME, VALUE_NUMBER_INT, FIELD_NAME, VALUE_NULL, END_OBJECT]\"><pre class=\"notranslate\"><code>[START_OBJECT, FIELD_NAME, VALUE_NUMBER_INT, FIELD_NAME, VALUE_NULL, END_OBJECT]\n</code></pre></div>\n<p dir=\"auto\">But, buffers ends up being started with field name and then contains single attribute value</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[FIELD_NAME, VALUE_NUMBER_INT]\"><pre class=\"notranslate\"><code>[FIELD_NAME, VALUE_NUMBER_INT]\n</code></pre></div>\n<p dir=\"auto\">It's due to how <code class=\"notranslate\">TokenBuffer#copyCurrentStructure</code> works when we have current token as a <code class=\"notranslate\">FIELD_NAME</code>, rather than <code class=\"notranslate\">START_OBJECT</code>, because it's forced to move to next token <a href=\"https://github.com/FasterXML/jackson-databind/blob/2.4/src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializer.java#L120\">BeanDeserializer.java:120</a></p>\n<p dir=\"auto\">Hope this helps to nail it down. Is it an intended behavior, or it's regression/bug?</p>\n"}