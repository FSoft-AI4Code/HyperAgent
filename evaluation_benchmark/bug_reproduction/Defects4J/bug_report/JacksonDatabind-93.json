{"issue_id": "1872", "title": "<code>NullPointerException</code> in <code>SubTypeValidator.validateSubType</code> when validating Spring interface", "description": "\n<p dir=\"auto\">In jackson-databind-2.8.11 jackson-databind-2.9.3 and  jackson-databind-2.9.4-SNAPSHOT <code class=\"notranslate\">SubTypeValidator.validateSubType</code> fails with a <code class=\"notranslate\">NullPointerException</code> if the <code class=\"notranslate\">JavaType.getRawClass()</code> is an interface that starts with <code class=\"notranslate\">org.springframework.</code> For example, the following will fail:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"package org.springframework.security.core;\n\nimport java.util.*;\n\npublic class Authentication {\n\tprivate List&lt;GrantedAuthority&gt; authorities = new ArrayList&lt;GrantedAuthority&gt;();\n\n\tpublic List&lt;GrantedAuthority&gt; getAuthorities() {\n\t\treturn this.authorities;\n\t}\n\n\tpublic void setAuthorities(List&lt;GrantedAuthority&gt; authorities) {\n\t\tthis.authorities = authorities;\n\t}\n}\"><pre><span class=\"pl-k\">package</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">springframework</span>.<span class=\"pl-s1\">security</span>.<span class=\"pl-s1\">core</span>;\n\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">java</span>.<span class=\"pl-s1\">util</span>.*;\n\n<span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-smi\">Authentication</span> {\n\t<span class=\"pl-k\">private</span> <span class=\"pl-smi\">List</span>&lt;<span class=\"pl-smi\">GrantedAuthority</span>&gt; <span class=\"pl-s1\">authorities</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ArrayList</span>&lt;<span class=\"pl-smi\">GrantedAuthority</span>&gt;();\n\n\t<span class=\"pl-k\">public</span> <span class=\"pl-smi\">List</span>&lt;<span class=\"pl-smi\">GrantedAuthority</span>&gt; <span class=\"pl-en\">getAuthorities</span>() {\n\t\t<span class=\"pl-k\">return</span> <span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">authorities</span>;\n\t}\n\n\t<span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">setAuthorities</span>(<span class=\"pl-smi\">List</span>&lt;<span class=\"pl-smi\">GrantedAuthority</span>&gt; <span class=\"pl-s1\">authorities</span>) {\n\t\t<span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">authorities</span> = <span class=\"pl-s1\">authorities</span>;\n\t}\n}</pre></div>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"package org.springframework.security.core;\n\npublic interface GrantedAuthority {\n\tString getAuthority();\n}\"><pre><span class=\"pl-k\">package</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">springframework</span>.<span class=\"pl-s1\">security</span>.<span class=\"pl-s1\">core</span>;\n\n<span class=\"pl-k\">public</span> <span class=\"pl-k\">interface</span> <span class=\"pl-smi\">GrantedAuthority</span> {\n\t<span class=\"pl-smi\">String</span> <span class=\"pl-en\">getAuthority</span>();\n}</pre></div>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='@Test\npublic void validateSubTypeFailsWithNPE() throws Exception {\n\tObjectMapper mapper = new ObjectMapper();\n\tmapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);\n\n\tString json = \"{\\\"@class\\\":\\\"org.springframework.security.core.Authentication\\\",\\\"authorities\\\":[\\\"java.util.ArrayList\\\",[]]}\";\n\n\tAuthentication authentication = mapper.readValue(json, Authentication.class);\n}'><pre><span class=\"pl-c1\">@</span><span class=\"pl-c1\">Test</span>\n<span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">validateSubTypeFailsWithNPE</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-s1\">Exception</span> {\n\t<span class=\"pl-smi\">ObjectMapper</span> <span class=\"pl-s1\">mapper</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ObjectMapper</span>();\n\t<span class=\"pl-s1\">mapper</span>.<span class=\"pl-en\">enableDefaultTyping</span>(<span class=\"pl-smi\">ObjectMapper</span>.<span class=\"pl-s1\">DefaultTyping</span>.<span class=\"pl-c1\">NON_FINAL</span>, <span class=\"pl-smi\">JsonTypeInfo</span>.<span class=\"pl-s1\">As</span>.<span class=\"pl-c1\">PROPERTY</span>);\n\n\t<span class=\"pl-smi\">String</span> <span class=\"pl-s1\">json</span> = <span class=\"pl-s\">\"{\\\"@class\\\":\\\"org.springframework.security.core.Authentication\\\",\\\"authorities\\\":[\\\"java.util.ArrayList\\\",[]]}\"</span>;\n\n\t<span class=\"pl-smi\">Authentication</span> <span class=\"pl-s1\">authentication</span> = <span class=\"pl-s1\">mapper</span>.<span class=\"pl-en\">readValue</span>(<span class=\"pl-s1\">json</span>, <span class=\"pl-smi\">Authentication</span>.<span class=\"pl-s1\">class</span>);\n}</pre></div>\n<p dir=\"auto\">with the following stacktrace:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.lang.NullPointerException\n\tat com.fasterxml.jackson.databind.jsontype.impl.SubTypeValidator.validateSubType(SubTypeValidator.java:86)\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializerFactory._validateSubType(BeanDeserializerFactory.java:916)\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializerFactory.createBeanDeserializer(BeanDeserializerFactory.java:135)\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createDeserializer2(DeserializerCache.java:411)\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createDeserializer(DeserializerCache.java:349)\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createAndCache2(DeserializerCache.java:264)\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createAndCacheValueDeserializer(DeserializerCache.java:244)\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache.findValueDeserializer(DeserializerCache.java:142)\n\tat com.fasterxml.jackson.databind.DeserializationContext.findContextualValueDeserializer(DeserializationContext.java:444)\n\tat com.fasterxml.jackson.databind.deser.std.CollectionDeserializer.createContextual(CollectionDeserializer.java:183)\n\tat com.fasterxml.jackson.databind.deser.std.CollectionDeserializer.createContextual(CollectionDeserializer.java:27)\n\tat com.fasterxml.jackson.databind.DeserializationContext.handlePrimaryContextualization(DeserializationContext.java:651)\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializerBase.resolve(BeanDeserializerBase.java:471)\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createAndCache2(DeserializerCache.java:293)\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createAndCacheValueDeserializer(DeserializerCache.java:244)\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache.findValueDeserializer(DeserializerCache.java:142)\n\tat com.fasterxml.jackson.databind.DeserializationContext.findRootValueDeserializer(DeserializationContext.java:477)\n\tat com.fasterxml.jackson.databind.ObjectMapper._findRootDeserializer(ObjectMapper.java:4178)\n\tat com.fasterxml.jackson.databind.ObjectMapper._readMapAndClose(ObjectMapper.java:3997)\n\tat com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:2992)\"><pre class=\"notranslate\"><code>java.lang.NullPointerException\n\tat com.fasterxml.jackson.databind.jsontype.impl.SubTypeValidator.validateSubType(SubTypeValidator.java:86)\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializerFactory._validateSubType(BeanDeserializerFactory.java:916)\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializerFactory.createBeanDeserializer(BeanDeserializerFactory.java:135)\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createDeserializer2(DeserializerCache.java:411)\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createDeserializer(DeserializerCache.java:349)\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createAndCache2(DeserializerCache.java:264)\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createAndCacheValueDeserializer(DeserializerCache.java:244)\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache.findValueDeserializer(DeserializerCache.java:142)\n\tat com.fasterxml.jackson.databind.DeserializationContext.findContextualValueDeserializer(DeserializationContext.java:444)\n\tat com.fasterxml.jackson.databind.deser.std.CollectionDeserializer.createContextual(CollectionDeserializer.java:183)\n\tat com.fasterxml.jackson.databind.deser.std.CollectionDeserializer.createContextual(CollectionDeserializer.java:27)\n\tat com.fasterxml.jackson.databind.DeserializationContext.handlePrimaryContextualization(DeserializationContext.java:651)\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializerBase.resolve(BeanDeserializerBase.java:471)\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createAndCache2(DeserializerCache.java:293)\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createAndCacheValueDeserializer(DeserializerCache.java:244)\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache.findValueDeserializer(DeserializerCache.java:142)\n\tat com.fasterxml.jackson.databind.DeserializationContext.findRootValueDeserializer(DeserializationContext.java:477)\n\tat com.fasterxml.jackson.databind.ObjectMapper._findRootDeserializer(ObjectMapper.java:4178)\n\tat com.fasterxml.jackson.databind.ObjectMapper._readMapAndClose(ObjectMapper.java:3997)\n\tat com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:2992)\n</code></pre></div>\n<p dir=\"auto\">In prior versions, the test works.</p>\n"}