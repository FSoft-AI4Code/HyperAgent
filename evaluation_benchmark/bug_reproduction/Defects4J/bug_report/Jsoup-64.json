{"issue_id": "906", "title": "Incorrect handling of self-closing tags noframes, style and title cause remainder of document to be html-escaped", "description": "\n<p dir=\"auto\">Given the input:</p>\n<div class=\"highlight highlight-text-html-basic notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&lt;html&gt;\n&lt;head&gt;\n\t&lt;style /&gt;   &lt;!-- &lt; - - this is the culprit --&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\t&lt;p&gt;Whatever&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\"><pre><span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">html</span><span class=\"pl-kos\">&gt;</span>\n<span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">head</span><span class=\"pl-kos\">&gt;</span>\n\t<span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">style</span> /&gt;   <span class=\"pl-c\">&lt;!-- &lt; - - this is the culprit --&gt;</span>\n<span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">head</span><span class=\"pl-kos\">&gt;</span>\n<span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">body</span><span class=\"pl-kos\">&gt;</span>\n\t<span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">p</span><span class=\"pl-kos\">&gt;</span>Whatever<span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">p</span><span class=\"pl-kos\">&gt;</span>\n<span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">body</span><span class=\"pl-kos\">&gt;</span>\n<span class=\"pl-kos\">&lt;/</span>html<span class=\"pl-kos\">&gt;</span></pre></div>\n<p dir=\"auto\">JSoup 1.8.2 and also <a href=\"http://try.jsoup.org/~lJwWpjXYUSTBeBZhdEnS3Mt56g4\" rel=\"nofollow\">http://try.jsoup.org/~lJwWpjXYUSTBeBZhdEnS3Mt56g4</a> will produce:</p>\n<div class=\"highlight highlight-text-html-basic notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    &lt;html&gt;\n     &lt;head&gt; \n      &lt;style&gt;&lt;/style&gt;\n     &lt;/head&gt;\n     &lt;body&gt;\n       &amp;lt;/head&amp;gt; &amp;lt;body&amp;gt; &amp;lt;p&amp;gt;Whatever&amp;lt;/p&amp;gt; &amp;lt;/body&amp;gt; &amp;lt;/html&amp;gt;\n     &lt;/body&gt;\n    &lt;/html&gt;\"><pre>    <span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">html</span><span class=\"pl-kos\">&gt;</span>\n     <span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">head</span><span class=\"pl-kos\">&gt;</span> \n      <span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">style</span><span class=\"pl-kos\">&gt;</span><span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">style</span><span class=\"pl-kos\">&gt;</span>\n     <span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">head</span><span class=\"pl-kos\">&gt;</span>\n     <span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">body</span><span class=\"pl-kos\">&gt;</span>\n       &amp;lt;/head&amp;gt; &amp;lt;body&amp;gt; &amp;lt;p&amp;gt;Whatever&amp;lt;/p&amp;gt; &amp;lt;/body&amp;gt; &amp;lt;/html&amp;gt;\n     <span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">body</span><span class=\"pl-kos\">&gt;</span>\n    <span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">html</span><span class=\"pl-kos\">&gt;</span></pre></div>\n<p dir=\"auto\">With <code class=\"notranslate\">&lt;title/&gt;</code> instead of <code class=\"notranslate\">&lt;style/&gt;</code>, the result is different but still wrong (<a href=\"http://try.jsoup.org/~BZ3uoMki-r904fZxUOWJgLJO7r8\" rel=\"nofollow\">http://try.jsoup.org/~BZ3uoMki-r904fZxUOWJgLJO7r8</a> ):</p>\n<div class=\"highlight highlight-text-html-basic notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&lt;html&gt;\n &lt;head&gt; \n  &lt;title&gt;&lt;/title&gt;\n &lt;/head&gt;\n &lt;body&gt;\n   &amp;lt;/head&amp;gt;  \n  &lt;p&gt;Whatever&lt;/p&gt;  \n &lt;/body&gt;\n&lt;/html&gt;\"><pre><span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">html</span><span class=\"pl-kos\">&gt;</span>\n <span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">head</span><span class=\"pl-kos\">&gt;</span> \n  <span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">title</span><span class=\"pl-kos\">&gt;</span><span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">title</span><span class=\"pl-kos\">&gt;</span>\n <span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">head</span><span class=\"pl-kos\">&gt;</span>\n <span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">body</span><span class=\"pl-kos\">&gt;</span>\n   &amp;lt;/head&amp;gt;  \n  <span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">p</span><span class=\"pl-kos\">&gt;</span>Whatever<span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">p</span><span class=\"pl-kos\">&gt;</span>  \n <span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">body</span><span class=\"pl-kos\">&gt;</span>\n<span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">html</span><span class=\"pl-kos\">&gt;</span></pre></div>\n<p dir=\"auto\">That weirdness was fixed for <code class=\"notranslate\">&lt;script&gt;</code> with Issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-hovercard-type=\"issue\" data-hovercard-url=\"/jhy/jsoup/issues/305/hovercard\" data-id=\"11916931\" data-permission-text=\"Title is private\" data-url=\"https://github.com/jhy/jsoup/issues/305\" href=\"https://github.com/jhy/jsoup/issues/305\">#305</a>: <a href=\"http://try.jsoup.org/~3Ms6TQCrrdaA_uPgxgURYYvwFAg\" rel=\"nofollow\">http://try.jsoup.org/~3Ms6TQCrrdaA_uPgxgURYYvwFAg</a></p>\n<div class=\"highlight highlight-text-html-basic notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&lt;html&gt;\n &lt;head&gt; \n  &lt;script&gt;&lt;/script&gt; \n &lt;/head&gt; \n &lt;body&gt; \n  &lt;p&gt;Whatever&lt;/p&gt;  \n &lt;/body&gt;\n&lt;/html&gt;\"><pre><span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">html</span><span class=\"pl-kos\">&gt;</span>\n <span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">head</span><span class=\"pl-kos\">&gt;</span> \n  <span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">script</span><span class=\"pl-kos\">&gt;</span><span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">script</span><span class=\"pl-kos\">&gt;</span> \n <span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">head</span><span class=\"pl-kos\">&gt;</span> \n <span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">body</span><span class=\"pl-kos\">&gt;</span> \n  <span class=\"pl-kos\">&lt;</span><span class=\"pl-ent\">p</span><span class=\"pl-kos\">&gt;</span>Whatever<span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">p</span><span class=\"pl-kos\">&gt;</span>  \n <span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">body</span><span class=\"pl-kos\">&gt;</span>\n<span class=\"pl-kos\">&lt;/</span><span class=\"pl-ent\">html</span><span class=\"pl-kos\">&gt;</span></pre></div>\n<p dir=\"auto\">Looking <a href=\"https://github.com/jhy/jsoup/blob/master/src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java#L106\">at the source</a>, it seems only the HtmlTreeBuilderState handling for <code class=\"notranslate\">&lt;noframes&gt;</code>, <code class=\"notranslate\">&lt;style&gt;</code> and <code class=\"notranslate\">&lt;title&gt;</code> in the methods <code class=\"notranslate\">handleRawText</code> and <code class=\"notranslate\">handleRcData</code> doesn't get along with the self-closing tags.<br/>\nAny other tagname I've checked (and I tried to cover all branches of that <code class=\"notranslate\">case StartTag</code> switch) results in a good parse similar to the <code class=\"notranslate\">&lt;script&gt;</code> case, which is what I'd expect.</p>\n<p dir=\"auto\">Thanks for looking into this!</p>\n"}