{"issue_id": "489", "title": "FormElement's formData ignores input checkbox checked without value.", "description": "\n<p dir=\"auto\">When there is input:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='&lt;input type=\"checkbox\" name=\"testCheckBox\" checked=\"checked\" /&gt;'><pre class=\"notranslate\"><code>&lt;input type=\"checkbox\" name=\"testCheckBox\" checked=\"checked\" /&gt;\n</code></pre></div>\n<p dir=\"auto\">The \"formData()\" of FormElement's ignores that default value which should be \"on\" as submitted by browsers.</p>\n<p dir=\"auto\">HTML fragment:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='&lt;html&gt;\n    &lt;head&gt;\n        &lt;title&gt;Test&lt;/title&gt;\n    &lt;/head&gt;\n\n    &lt;body&gt;\n\n    &lt;form name=\"myForm\" method=\"POST\"&gt;\n        &lt;input type=\"checkbox\" name=\"testCheckBox\" checked=\"checked\" /&gt; Something&lt;br/&gt;\n\n        &lt;input type=\"submit\" value=\"Submit\" /&gt;\n    &lt;/form&gt;\n\n    &lt;/body&gt;\n&lt;/html&gt;'><pre class=\"notranslate\"><code>&lt;html&gt;\n    &lt;head&gt;\n        &lt;title&gt;Test&lt;/title&gt;\n    &lt;/head&gt;\n\n    &lt;body&gt;\n\n    &lt;form name=\"myForm\" method=\"POST\"&gt;\n        &lt;input type=\"checkbox\" name=\"testCheckBox\" checked=\"checked\" /&gt; Something&lt;br/&gt;\n\n        &lt;input type=\"submit\" value=\"Submit\" /&gt;\n    &lt;/form&gt;\n\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre></div>\n<p dir=\"auto\">When submiting from Firefox it sends to sever: testCheckBox=on</p>\n<p dir=\"auto\">Java code:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='    public static void main(String[] args)\n    {\n        final String html = \"&lt;html&gt;\\n\"\n                            + \"    &lt;head&gt;\\n\"\n                            + \"        &lt;title&gt;Test&lt;/title&gt;\\n\"\n                            + \"    &lt;/head&gt;\\n\"\n                            + \"    \\n\"\n                            + \"    &lt;body&gt;\\n\"\n                            + \"\\n\"\n                            + \"    &lt;form name=\\\"myForm\\\" method=\\\"POST\\\"&gt;\\n\"\n                            + \"        &lt;input type=\\\"checkbox\\\" name=\\\"testCheckBox\\\" checked=\\\"checked\\\" /&gt; Something&lt;br/&gt;\\n\"\n                            + \"\\n\"\n                            + \"        &lt;input type=\\\"submit\\\" value=\\\"Submit\\\" /&gt;\\n\"\n                            + \"    &lt;/form&gt;\\n\"\n                            + \"\\n\"\n                            + \"    &lt;/body&gt;\\n\"\n                            + \"&lt;/html&gt;\";\n\n        final Document document = Jsoup.parse(html);\n\n        final FormElement formElement = (FormElement) document.select(\"form[name=myForm]\").first();\n\n        for (Connection.KeyVal keyVal : formElement.formData())\n        {\n            System.out.println(keyVal.key() + \"=\" + keyVal.value());\n        }\n\n    }'><pre class=\"notranslate\"><code>    public static void main(String[] args)\n    {\n        final String html = \"&lt;html&gt;\\n\"\n                            + \"    &lt;head&gt;\\n\"\n                            + \"        &lt;title&gt;Test&lt;/title&gt;\\n\"\n                            + \"    &lt;/head&gt;\\n\"\n                            + \"    \\n\"\n                            + \"    &lt;body&gt;\\n\"\n                            + \"\\n\"\n                            + \"    &lt;form name=\\\"myForm\\\" method=\\\"POST\\\"&gt;\\n\"\n                            + \"        &lt;input type=\\\"checkbox\\\" name=\\\"testCheckBox\\\" checked=\\\"checked\\\" /&gt; Something&lt;br/&gt;\\n\"\n                            + \"\\n\"\n                            + \"        &lt;input type=\\\"submit\\\" value=\\\"Submit\\\" /&gt;\\n\"\n                            + \"    &lt;/form&gt;\\n\"\n                            + \"\\n\"\n                            + \"    &lt;/body&gt;\\n\"\n                            + \"&lt;/html&gt;\";\n\n        final Document document = Jsoup.parse(html);\n\n        final FormElement formElement = (FormElement) document.select(\"form[name=myForm]\").first();\n\n        for (Connection.KeyVal keyVal : formElement.formData())\n        {\n            System.out.println(keyVal.key() + \"=\" + keyVal.value());\n        }\n\n    }\n</code></pre></div>\n<p dir=\"auto\">Output: testCheckBox=</p>\n<p dir=\"auto\">Expected output: testCheckBox=on</p>\n<p dir=\"auto\">Seems like Jsoup doesn't add default value which is sent by browsers. The \"submit()\" method from FormElement also uses \"formData()\" method to get form's submission parameters. By sending the empty String for checkbox the server acts as it's not checked when in fact it was checked.</p>\n<p dir=\"auto\">Also while testing noticed that it doesn't check the checkbox'es at all. If there is checkbox with value, but not checked, it will get the value no matter what, for example:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='        &lt;input type=\"checkbox\" name=\"textCheckBox2\" value=\"testVal\" /&gt; '><pre class=\"notranslate\"><code>        &lt;input type=\"checkbox\" name=\"textCheckBox2\" value=\"testVal\" /&gt; \n</code></pre></div>\n<p dir=\"auto\">This affects radio buttons as well. Not selected radion buttons should not be sent to server, but formData() add their values anyway.</p>\n<p dir=\"auto\">I'm not sure if that's done on purpose, but submit() method will get wrong parameters for submission since not checked input value is not sent to server at all.</p>\n<p dir=\"auto\">Moreover type button value and \"disabled\" inputs are not sent to server as well (by browsers).</p>\n<p dir=\"auto\">Looked at the source, one extra else if before the final else in \"formData()\" method could solve this:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"else if (&quot;input&quot;.equals(el.tagName())) {\n                // Not disabled? Ignore disabled inputs.\n                if(!el.hasAttr(&quot;disabled&quot;)) {\n\n                    // Deal with checkbox and radio (not checked should not be added to avoid sending to server)\n                    if(&quot;checkbox&quot;.equals(el.attr(&quot;type&quot;)) || &quot;radio&quot;.equals(el.attr(&quot;type&quot;))) {\n\n                        // Checked, but no value? Default should be &quot;on&quot;.\n                        if(el.hasAttr(&quot;checked&quot;) &amp;&amp; !el.hasAttr(&quot;value&quot;)) {\n                            data.add(HttpConnection.KeyVal.create(name, &quot;on&quot;));\n                        } \n                        // Checked? Add it's value\n                        else if(el.hasAttr(&quot;checked&quot;)) {\n                            data.add(HttpConnection.KeyVal.create(name, el.val()));\n                        }\n                    } \n                    // Buttons should be ignored.\n                    else if(!&quot;button&quot;.equals(el.attr(&quot;type&quot;))){\n                        data.add(HttpConnection.KeyVal.create(name, el.val()));\n                    }\n                }\n            }\"><pre class=\"notranslate\"><code>else if (\"input\".equals(el.tagName())) {\n                // Not disabled? Ignore disabled inputs.\n                if(!el.hasAttr(\"disabled\")) {\n\n                    // Deal with checkbox and radio (not checked should not be added to avoid sending to server)\n                    if(\"checkbox\".equals(el.attr(\"type\")) || \"radio\".equals(el.attr(\"type\"))) {\n\n                        // Checked, but no value? Default should be \"on\".\n                        if(el.hasAttr(\"checked\") &amp;&amp; !el.hasAttr(\"value\")) {\n                            data.add(HttpConnection.KeyVal.create(name, \"on\"));\n                        } \n                        // Checked? Add it's value\n                        else if(el.hasAttr(\"checked\")) {\n                            data.add(HttpConnection.KeyVal.create(name, el.val()));\n                        }\n                    } \n                    // Buttons should be ignored.\n                    else if(!\"button\".equals(el.attr(\"type\"))){\n                        data.add(HttpConnection.KeyVal.create(name, el.val()));\n                    }\n                }\n            }\n</code></pre></div>\n<p dir=\"auto\">One more thing. If form has multiple type submit inputs, only the clicked input's value should be sent to server, but I have no idea how this could be implemented. Sending all submit input's values can change the server's logic and be bad (result not as expected).</p>\n"}