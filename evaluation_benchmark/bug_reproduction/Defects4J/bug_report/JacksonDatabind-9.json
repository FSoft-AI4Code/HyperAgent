{"issue_id": "682", "title": "Deserializing Map&lt;Class&lt;? extends Object&gt;, String&gt;", "description": "\n<p dir=\"auto\">I am having problems deserializing my <code class=\"notranslate\">Map&lt;Class&lt;? extends Object&gt;, String&gt;</code>. Simple test case demonstrates it:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='@Test\npublic void testMapWithClassAsKey() throws Exception {\n    Map&lt;Class&lt;? extends Object&gt;, String&gt; map = new HashMap&lt;&gt;();\n    map.put(ArrayList.class, \"ArrayList\");\n    map.put(HashMap.class, \"HashMap\");\n\n    ObjectMapper mapper = new ObjectMapper();\n\n    String json = mapper.writerWithDefaultPrettyPrinter().writeValueAsString(map);\n    System.out.println(json);\n    mapper.readValue(json, new TypeReference&lt;Map&lt;Class&lt;? extends Object&gt;, String&gt;&gt;(){});\n}'><pre><span class=\"pl-c1\">@</span><span class=\"pl-c1\">Test</span>\n<span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">testMapWithClassAsKey</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-s1\">Exception</span> {\n    <span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">Class</span>&lt;? <span class=\"pl-k\">extends</span> <span class=\"pl-smi\">Object</span>&gt;, <span class=\"pl-smi\">String</span>&gt; <span class=\"pl-s1\">map</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">HashMap</span>&lt;&gt;();\n    <span class=\"pl-s1\">map</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-smi\">ArrayList</span>.<span class=\"pl-s1\">class</span>, <span class=\"pl-s\">\"ArrayList\"</span>);\n    <span class=\"pl-s1\">map</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-smi\">HashMap</span>.<span class=\"pl-s1\">class</span>, <span class=\"pl-s\">\"HashMap\"</span>);\n\n    <span class=\"pl-smi\">ObjectMapper</span> <span class=\"pl-s1\">mapper</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ObjectMapper</span>();\n\n    <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">json</span> = <span class=\"pl-s1\">mapper</span>.<span class=\"pl-en\">writerWithDefaultPrettyPrinter</span>().<span class=\"pl-en\">writeValueAsString</span>(<span class=\"pl-s1\">map</span>);\n    <span class=\"pl-smi\">System</span>.<span class=\"pl-s1\">out</span>.<span class=\"pl-en\">println</span>(<span class=\"pl-s1\">json</span>);\n    <span class=\"pl-s1\">mapper</span>.<span class=\"pl-en\">readValue</span>(<span class=\"pl-s1\">json</span>, <span class=\"pl-k\">new</span> <span class=\"pl-smi\">TypeReference</span>&lt;<span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">Class</span>&lt;? <span class=\"pl-k\">extends</span> <span class=\"pl-smi\">Object</span>&gt;, <span class=\"pl-smi\">String</span>&gt;&gt;(){});\n}</pre></div>\n<p dir=\"auto\">This test serializes the map as:</p>\n<div class=\"highlight highlight-source-json notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='{\n    \"class java.util.ArrayList\" : \"ArrayList\",\n    \"class java.util.HashMap\" : \"HashMap\"\n}'><pre>{\n    <span class=\"pl-ent\">\"class java.util.ArrayList\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ArrayList<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"class java.util.HashMap\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>HashMap<span class=\"pl-pds\">\"</span></span>\n}</pre></div>\n<p dir=\"auto\"><code class=\"notranslate\">mapper.readValue(json, new TypeReference&lt;Map&lt;Class&lt;? extends Object&gt;, String&gt;&gt;(){});</code> then throws a <code class=\"notranslate\">Exception</code>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='com.fasterxml.jackson.databind.exc.InvalidFormatException: Can not construct     Map key of type java.lang.Class from String \"class java.util.ArrayList\": not a valid representation: Can not construct Map key of type java.lang.Class from String \"class java.util.ArrayList\": unable to parse key as Class\n at [Source: ...'><pre class=\"notranslate\"><code>com.fasterxml.jackson.databind.exc.InvalidFormatException: Can not construct     Map key of type java.lang.Class from String \"class java.util.ArrayList\": not a valid representation: Can not construct Map key of type java.lang.Class from String \"class java.util.ArrayList\": unable to parse key as Class\n at [Source: ...\n</code></pre></div>\n<p dir=\"auto\">As i understood from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-hovercard-type=\"issue\" data-hovercard-url=\"/FasterXML/jackson-databind/issues/630/hovercard\" data-id=\"49981670\" data-permission-text=\"Title is private\" data-url=\"https://github.com/FasterXML/jackson-databind/issues/630\" href=\"https://github.com/FasterXML/jackson-databind/issues/630\">#630</a> the KeyDeserializer for Class should be part of Jackson. Am I missing something?</p>\n"}