{"issue_id": "LANG-720", "title": "StringEscapeUtils.escapeXml(input) outputs wrong results when an input contains characters in Supplementary Planes.", "description": "\n<div class=\"user-content-block\">\n<p>Hello.</p>\n<p>I use StringEscapeUtils.escapeXml(input) to escape special characters for XML.<br/>\nThis method outputs wrong results when input contains characters in Supplementary Planes.</p>\n<p>String str1 = \"\\uD842\\uDFB7\" + \"A\";<br/>\nString str2 = StringEscapeUtils.escapeXml(str1);</p>\n<p>// The value of str2 must be equal to the one of str1,<br/>\n// because str1 does not contain characters to be escaped.<br/>\n// However, str2 is diffrent from str1.</p>\n<p>System.out.println(URLEncoder.encode(str1, \"UTF-16BE\")); //%D8%42%DF%B7A<br/>\nSystem.out.println(URLEncoder.encode(str2, \"UTF-16BE\")); //%D8%42%DF%B7%FF%FD</p>\n<p>The cause of this problem is that the loop to translate input character by character is wrong.<br/>\nIn CharSequenceTranslator.translate(CharSequence input, Writer out),<br/>\nloop counter \"i\" moves from 0 to Character.codePointCount(input, 0, input.length()),<br/>\nbut it should move from 0 to input.length().</p>\n</div>\n"}