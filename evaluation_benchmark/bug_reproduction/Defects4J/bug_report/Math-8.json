{"issue_id": "MATH-942", "title": "DiscreteDistribution.sample(int) may throw an exception if first element of singletons of sub-class type", "description": "\n<div class=\"user-content-block\">\n<p>Creating an array with <tt>Array.newInstance(singletons.get(0).getClass(), sampleSize)</tt> in DiscreteDistribution.sample(int) is risky. An exception will be thrown if:</p>\n<ul>\n<li><tt>singleons.get(0)</tt> is of type T1, an sub-class of T, and</li>\n<li><tt>DiscreteDistribution.sample()</tt> returns an object which is of type T, but not of type T1.</li>\n</ul>\n<p>To reproduce:</p>\n<div class=\"code panel\" style=\"border-width: 1px;\"><div class=\"codeContent panelContent\">\n<pre class=\"code-java\">List&lt;Pair&lt;<span class=\"code-object\">Object</span>,<span class=\"code-object\">Double</span>&gt;&gt; list = <span class=\"code-keyword\">new</span> ArrayList&lt;Pair&lt;<span class=\"code-object\">Object</span>, <span class=\"code-object\">Double</span>&gt;&gt;();\nlist.add(<span class=\"code-keyword\">new</span> Pair&lt;<span class=\"code-object\">Object</span>, <span class=\"code-object\">Double</span>&gt;(<span class=\"code-keyword\">new</span> <span class=\"code-object\">Object</span>() {}, <span class=\"code-keyword\">new</span> <span class=\"code-object\">Double</span>(0)));\nlist.add(<span class=\"code-keyword\">new</span> Pair&lt;<span class=\"code-object\">Object</span>, <span class=\"code-object\">Double</span>&gt;(<span class=\"code-keyword\">new</span> <span class=\"code-object\">Object</span>() {}, <span class=\"code-keyword\">new</span> <span class=\"code-object\">Double</span>(1)));\n<span class=\"code-keyword\">new</span> DiscreteDistribution&lt;<span class=\"code-object\">Object</span>&gt;(list).sample(1);\n</pre>\n</div></div>\n<p>Attaching a patch.</p>\n</div>\n"}