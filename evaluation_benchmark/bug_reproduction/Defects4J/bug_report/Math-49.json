{"issue_id": "MATH-645", "title": "MathRuntimeException with simple ebeMultiply on OpenMapRealVector", "description": "\n<div class=\"user-content-block\">\n<p>The following piece of code</p>\n<div class=\"code panel\" style=\"border-width: 1px;\"><div class=\"codeContent panelContent\">\n<pre class=\"code-java\"><span class=\"code-keyword\">import</span> org.apache.commons.math.linear.OpenMapRealVector;\n<span class=\"code-keyword\">import</span> org.apache.commons.math.linear.RealVector;\n\n<span class=\"code-keyword\">public</span> <span class=\"code-keyword\">class </span>DemoBugOpenMapRealVector {\n    <span class=\"code-keyword\">public</span> <span class=\"code-keyword\">static</span> void main(<span class=\"code-object\">String</span>[] args) {\n        <span class=\"code-keyword\">final</span> RealVector u = <span class=\"code-keyword\">new</span> OpenMapRealVector(3, 1E-6);\n        u.setEntry(0, 1.);\n        u.setEntry(1, 0.);\n        u.setEntry(2, 2.);\n        <span class=\"code-keyword\">final</span> RealVector v = <span class=\"code-keyword\">new</span> OpenMapRealVector(3, 1E-6);\n        v.setEntry(0, 0.);\n        v.setEntry(1, 3.);\n        v.setEntry(2, 0.);\n        <span class=\"code-object\">System</span>.out.println(u);\n        <span class=\"code-object\">System</span>.out.println(v);\n        <span class=\"code-object\">System</span>.out.println(u.ebeMultiply(v));\n    }\n}\n</pre>\n</div></div>\n<p>raises an exception</p>\n<div class=\"preformatted panel\" style=\"border-width: 1px;\"><div class=\"preformattedContent panelContent\">\n<pre>org.apache.commons.math.linear.OpenMapRealVector@7170a9b6\nException in thread \"main\" org.apache.commons.math.MathRuntimeException$6: map has been modified while iterating\n\tat org.apache.commons.math.MathRuntimeException.createConcurrentModificationException(MathRuntimeException.java:373)\n\tat org.apache.commons.math.util.OpenIntToDoubleHashMap$Iterator.advance(OpenIntToDoubleHashMap.java:564)\n\tat org.apache.commons.math.linear.OpenMapRealVector.ebeMultiply(OpenMapRealVector.java:372)\n\tat org.apache.commons.math.linear.OpenMapRealVector.ebeMultiply(OpenMapRealVector.java:1)\n\tat DemoBugOpenMapRealVector.main(DemoBugOpenMapRealVector.java:17)\n</pre>\n</div></div>\n</div>\n"}