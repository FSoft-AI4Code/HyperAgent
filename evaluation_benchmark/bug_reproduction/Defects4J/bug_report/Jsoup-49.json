{"issue_id": "689", "title": "Bug in Element.insertChildren()", "description": "\n<p dir=\"auto\">When using org.jsoup.nodes.Element.insertChildren(int, Collection&lt;? extends Node&gt;) to move (more than one!) child-elements from one parent-element to the same parent, but different index then it produces wrong results.</p>\n<p dir=\"auto\">The problem is that the first Element's 'move' leaves the siblingIndex unchanged and then the second 'move' removes a wrong element and produces some crap. Maybe calling reindexChildren() inside the loop in addChildren() fixes this.<br/>\nVersion 1.8.3.<br/>\nWorkaround: call remove() on the elements before passing them to insertChildren()</p>\n<p dir=\"auto\">Easy Test Case:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='    @Test\n    public void mustCorrectlyMoveChildrenInsideOneParentElement() {\n\n        Document doc = new Document( \"\" );\n        Element body = doc.appendElement( \"body\" );\n        body.appendElement( \"div1\" );\n        body.appendElement( \"div2\" );\n        Element div3 = body.appendElement( \"div3\" );\n        Element div4 = body.appendElement( \"div4\" );\n\n        ArrayList&lt;Element&gt; toMove = new ArrayList&lt;Element&gt;() {\n            {\n                add( div3 );\n                add( div4 );\n            }\n        };\n\n        body.insertChildren( 0, toMove );\n\n        String result = doc.toString().replaceAll( \"\\\\s+\", \"\" );\n        assertEquals( \"&lt;body&gt;&lt;div3&gt;&lt;/div3&gt;&lt;div4&gt;&lt;/div4&gt;&lt;div1&gt;&lt;/div1&gt;&lt;div2&gt;&lt;/div2&gt;&lt;/body&gt;\", result );\n\n    }'><pre class=\"notranslate\"><code>    @Test\n    public void mustCorrectlyMoveChildrenInsideOneParentElement() {\n\n        Document doc = new Document( \"\" );\n        Element body = doc.appendElement( \"body\" );\n        body.appendElement( \"div1\" );\n        body.appendElement( \"div2\" );\n        Element div3 = body.appendElement( \"div3\" );\n        Element div4 = body.appendElement( \"div4\" );\n\n        ArrayList&lt;Element&gt; toMove = new ArrayList&lt;Element&gt;() {\n            {\n                add( div3 );\n                add( div4 );\n            }\n        };\n\n        body.insertChildren( 0, toMove );\n\n        String result = doc.toString().replaceAll( \"\\\\s+\", \"\" );\n        assertEquals( \"&lt;body&gt;&lt;div3&gt;&lt;/div3&gt;&lt;div4&gt;&lt;/div4&gt;&lt;div1&gt;&lt;/div1&gt;&lt;div2&gt;&lt;/div2&gt;&lt;/body&gt;\", result );\n\n    }\n</code></pre></div>\n"}