{"issue_id": "LANG-294", "title": "StrBuilder.replaceAll and StrBuilder.deleteAll can throw ArrayIndexOutOfBoundsException.", "description": "\n<div class=\"user-content-block\">\n<p>StrBuilder.replaceAll and StrBuilder.deleteAll can thrown ArrayIndexOutOfBoundsException's. Here are a couple of additions to the StrBuilderTest class that demonstrate this problem:</p>\n<p>StrBuilder.deleteAll() - added to testDeleteAll_String():</p>\n<p>        sb = new StrBuilder(\"\\n%BLAH%\\nDo more stuff\\neven more stuff\\n%BLAH%\\n\");<br/>\n        sb.deleteAll(\"\\n%BLAH%\");<br/>\n        assertEquals(\"\\nDo more stuff\\neven more stuff\\n\", sb.toString());</p>\n<p>this causes the following error:<br/>\njava.lang.ArrayIndexOutOfBoundsException<br/>\n\tat java.lang.System.arraycopy(Native Method)<br/>\n\tat org.apache.commons.lang.text.StrBuilder.deleteImpl(StrBuilder.java:1114)<br/>\n\tat org.apache.commons.lang.text.StrBuilder.deleteAll(StrBuilder.java:1188)<br/>\n\tat org.apache.commons.lang.text.StrBuilderTest.testDeleteAll_String(StrBuilderTest.java:606)<br/>\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br/>\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)<br/>\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)<br/>\n\tat java.lang.reflect.Method.invoke(Method.java:585)<br/>\n\tat junit.framework.TestCase.runTest(TestCase.java:154)<br/>\n\tat junit.framework.TestCase.runBare(TestCase.java:127)<br/>\n\tat junit.framework.TestResult$1.protect(TestResult.java:106)<br/>\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)<br/>\n\tat junit.framework.TestResult.run(TestResult.java:109)<br/>\n\tat junit.framework.TestCase.run(TestCase.java:118)<br/>\n\tat junit.framework.TestSuite.runTest(TestSuite.java:208)<br/>\n\tat junit.framework.TestSuite.run(TestSuite.java:203)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:128)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)</p>\n<p>StrBuilder.replaceAll() - added to testReplaceAll_String_String():</p>\n<p>        sb = new StrBuilder(\"\\n%BLAH%\\nDo more stuff\\neven more stuff\\n%BLAH%\\n\");<br/>\n        sb.replaceAll(\"\\n%BLAH%\", \"\");<br/>\n        assertEquals(\"\\nDo more stuff\\neven more stuff\\n\", sb.toString());</p>\n<p>this causes the exception:</p>\n<p>java.lang.ArrayIndexOutOfBoundsException<br/>\n\tat java.lang.System.arraycopy(Native Method)<br/>\n\tat org.apache.commons.lang.text.StrBuilder.replaceImpl(StrBuilder.java:1256)<br/>\n\tat org.apache.commons.lang.text.StrBuilder.replaceAll(StrBuilder.java:1339)<br/>\n\tat org.apache.commons.lang.text.StrBuilderTest.testReplaceAll_String_String(StrBuilderTest.java:763)<br/>\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br/>\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)<br/>\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)<br/>\n\tat java.lang.reflect.Method.invoke(Method.java:585)<br/>\n\tat junit.framework.TestCase.runTest(TestCase.java:154)<br/>\n\tat junit.framework.TestCase.runBare(TestCase.java:127)<br/>\n\tat junit.framework.TestResult$1.protect(TestResult.java:106)<br/>\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)<br/>\n\tat junit.framework.TestResult.run(TestResult.java:109)<br/>\n\tat junit.framework.TestCase.run(TestCase.java:118)<br/>\n\tat junit.framework.TestSuite.runTest(TestSuite.java:208)<br/>\n\tat junit.framework.TestSuite.run(TestSuite.java:203)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:128)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)</p>\n</div>\n"}