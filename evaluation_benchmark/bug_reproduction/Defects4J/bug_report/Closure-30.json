{"issue_id": "698", "title": "Combining temporary strings are over-optimized in advanced build", "description": "<b>What steps will reproduce the problem?</b>\n1. This bug only manifests itself in large code bases. How large, and what the specifics are, I haven't yet worked out, since the output differs. But the principle code is:\r\n\r\nsgxColorRGBA.prototype.asHex = function() {\r\n\tvar hexString = &quot;&quot;;\r\n\t\r\n\tstr = (sgxFloor(this.r*255)).toString(16);\r\n\tif (str.length &lt; 2) { str = &quot;0&quot;+str; }\r\n\thexString += str;\r\n\r\n\tstr = (sgxFloor(this.g*255)).toString(16);\r\n\tif (str.length &lt; 2) { str = &quot;0&quot;+str; }\r\n\thexString += str;\r\n\r\n\tstr = (sgxFloor(this.b*255)).toString(16);\r\n\tif (str.length &lt; 2) { str = &quot;0&quot;+str; }\r\n\thexString += str;\r\n\r\n\tstr = (sgxFloor(this.a*255)).toString(16);\r\n\tif (str.length &lt; 2) { str = &quot;0&quot;+str; }\r\n\thexString += str;\r\n\r\n\treturn hexString;\r\n}\r\n\r\nNote that 'str' is not declared as var.\r\n\r\n<b>What is the expected output? What do you see instead?</b>\nI see this:\r\nsgxColorRGBA.prototype.pb = function() {\r\n  str = A(255 * this.A).toString(16);\r\n  2 &gt; str.length &amp;&amp; (str = &quot;0&quot; + str);\r\n  str = A(255 * this.w).toString(16);\r\n  2 &gt; str.length &amp;&amp; (str = &quot;0&quot; + str);\r\n  str = A(255 * this.s).toString(16);\r\n  2 &gt; str.length &amp;&amp; (str = &quot;0&quot; + str);\r\n  str = A(255 * this.r).toString(16);\r\n  2 &gt; str.length &amp;&amp; (str = &quot;0&quot; + str);\r\n  return&quot;&quot; + str + str + str + str\r\n};\r\n\r\nObviously, repeatedly adding 'str' is broken in the final line, compared to the original. So whatever is aggregating the result is seeing a temporary 'str' reference and combining it, I guess. If 'str' is declared as var, the problem goes away.\r\n\r\nI'd expect a warning, at least.\r\n\r\n<b>What version of the product are you using? On what operating system?</b>\n\r\nLive at http://closure-compiler.appspot.com\r\n\r\n<b>Please provide any additional information below.</b>\n\r\nAs a stand-alone method, both 'var str' and 'str' works. It's only when the project hits a certain (undetermined) size that it fails.\r\n\r\n"}