{"issue_id": "1809", "title": "2.9.2 deserialization regression", "description": "\n<p dir=\"auto\">There seems to be a regression in the latest 2.9.2 release.</p>\n<p dir=\"auto\">Using <code class=\"notranslate\">org.apache.logging.log4j.core.jackson.Log4jJsonObjectMapper</code> from <code class=\"notranslate\">org.apache.logging.log4j:log4j-core:2.9.1</code> to deserialize the appended JSON object is throwing an exception with 2.9.2 but worked with 2.9.1.</p>\n<p dir=\"auto\"><code class=\"notranslate\">org.apache.logging.log4j.core.jackson.Log4jYamlObjectMapper</code> and <code class=\"notranslate\">org.apache.logging.log4j.core.jackson.Log4jXmlObjectMapper</code> fail in similar ways.</p>\n<h3 dir=\"auto\">inputString</h3>\n<div class=\"highlight highlight-source-json notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content='{\n  \"timeMillis\" : 1493121664118,\n  \"thread\" : \"main\",\n  \"threadId\" : 1,\n  \"threadPriority\" : 5,\n  \"level\" : \"INFO\",\n  \"loggerName\" : \"HelloWorld\",\n  \"marker\" : {\n    \"name\" : \"child\",\n    \"parents\" : [ {\n      \"name\" : \"parent\",\n      \"parents\" : [ {\n        \"name\" : \"grandparent\"\n      } ]\n    } ]\n  },\n  \"message\" : \"Hello, world!\",\n  \"thrown\" : {\n    \"commonElementCount\" : 0,\n    \"message\" : \"error message\",\n    \"name\" : \"java.lang.RuntimeException\",\n    \"extendedStackTrace\" : [ {\n      \"class\" : \"logtest.Main\",\n      \"method\" : \"main\",\n      \"file\" : \"Main.java\",\n      \"line\" : 29,\n      \"exact\" : true,\n      \"location\" : \"classes/\",\n      \"version\" : \"?\"\n    } ]\n  },\n  \"contextStack\" : [ \"one\", \"two\" ],\n  \"loggerFqcn\" : \"org.apache.logging.log4j.spi.AbstractLogger\",\n  \"endOfBatch\" : false,\n  \"contextMap\" : {\n    \"bar\" : \"BAR\",\n    \"foo\" : \"FOO\"\n  },\n  \"source\" : {\n    \"class\" : \"logtest.Main\",\n    \"method\" : \"main\",\n    \"file\" : \"Main.java\",\n    \"line\" : 29\n  }\n}'><pre>{\n  <span class=\"pl-ent\">\"timeMillis\" </span>: <span class=\"pl-c1\">1493121664118</span>,\n  <span class=\"pl-ent\">\"thread\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>main<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-ent\">\"threadId\" </span>: <span class=\"pl-c1\">1</span>,\n  <span class=\"pl-ent\">\"threadPriority\" </span>: <span class=\"pl-c1\">5</span>,\n  <span class=\"pl-ent\">\"level\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>INFO<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-ent\">\"loggerName\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>HelloWorld<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-ent\">\"marker\" </span>: {\n    <span class=\"pl-ent\">\"name\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>child<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"parents\" </span>: [ {\n      <span class=\"pl-ent\">\"name\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>parent<span class=\"pl-pds\">\"</span></span>,\n      <span class=\"pl-ent\">\"parents\" </span>: [ {\n        <span class=\"pl-ent\">\"name\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>grandparent<span class=\"pl-pds\">\"</span></span>\n      } ]\n    } ]\n  },\n  <span class=\"pl-ent\">\"message\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Hello, world!<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-ent\">\"thrown\" </span>: {\n    <span class=\"pl-ent\">\"commonElementCount\" </span>: <span class=\"pl-c1\">0</span>,\n    <span class=\"pl-ent\">\"message\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>error message<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"name\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>java.lang.RuntimeException<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"extendedStackTrace\" </span>: [ {\n      <span class=\"pl-ent\">\"class\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>logtest.Main<span class=\"pl-pds\">\"</span></span>,\n      <span class=\"pl-ent\">\"method\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>main<span class=\"pl-pds\">\"</span></span>,\n      <span class=\"pl-ent\">\"file\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Main.java<span class=\"pl-pds\">\"</span></span>,\n      <span class=\"pl-ent\">\"line\" </span>: <span class=\"pl-c1\">29</span>,\n      <span class=\"pl-ent\">\"exact\" </span>: <span class=\"pl-c1\">true</span>,\n      <span class=\"pl-ent\">\"location\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>classes/<span class=\"pl-pds\">\"</span></span>,\n      <span class=\"pl-ent\">\"version\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>?<span class=\"pl-pds\">\"</span></span>\n    } ]\n  },\n  <span class=\"pl-ent\">\"contextStack\" </span>: [ <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>one<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>two<span class=\"pl-pds\">\"</span> </span>],\n  <span class=\"pl-ent\">\"loggerFqcn\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>org.apache.logging.log4j.spi.AbstractLogger<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-ent\">\"endOfBatch\" </span>: <span class=\"pl-c1\">false</span>,\n  <span class=\"pl-ent\">\"contextMap\" </span>: {\n    <span class=\"pl-ent\">\"bar\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>BAR<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"foo\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>FOO<span class=\"pl-pds\">\"</span></span>\n  },\n  <span class=\"pl-ent\">\"source\" </span>: {\n    <span class=\"pl-ent\">\"class\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>logtest.Main<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"method\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>main<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"file\" </span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Main.java<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"line\" </span>: <span class=\"pl-c1\">29</span>\n  }\n}</pre></div>\n<h3 dir=\"auto\">Exception</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"org.apache.logging.log4j.core.parser.ParseException: com.fasterxml.jackson.databind.exc.MismatchedInputException: Cannot construct instance of `org.apache.logging.log4j.Level` (although at least one Creator exists): no String-argument constructor/factory method to deserialize from String value ('INFO')\n at [Source: (byte[])&quot;{\n  &quot;timeMillis&quot; : 1493121664118,\n  &quot;thread&quot; : &quot;main&quot;,\n  &quot;threadId&quot; : 1,\n  &quot;threadPriority&quot; : 5,\n  &quot;level&quot; : &quot;INFO&quot;,\n  &quot;loggerName&quot; : &quot;HelloWorld&quot;,\n  &quot;marker&quot; : {\n    &quot;name&quot; : &quot;child&quot;,\n    &quot;parents&quot; : [ {\n      &quot;name&quot; : &quot;parent&quot;,\n      &quot;parents&quot; : [ {\n        &quot;name&quot; : &quot;grandparent&quot;\n      } ]\n    } ]\n  },\n  &quot;message&quot; : &quot;Hello, world!&quot;,\n  &quot;thrown&quot; : {\n    &quot;commonElementCount&quot; : 0,\n    &quot;message&quot; : &quot;error message&quot;,\n    &quot;name&quot; : &quot;java.lang.RuntimeException&quot;,\n    &quot;extendedStackTrace&quot; : [ {\n      &quot;clas&quot;[truncated 482 bytes]; line: 6, column: 13] (through reference chain: org.apache.logging.log4j.core.impl.Log4jLogEvent[&quot;level&quot;])\"><pre class=\"notranslate\"><code>org.apache.logging.log4j.core.parser.ParseException: com.fasterxml.jackson.databind.exc.MismatchedInputException: Cannot construct instance of `org.apache.logging.log4j.Level` (although at least one Creator exists): no String-argument constructor/factory method to deserialize from String value ('INFO')\n at [Source: (byte[])\"{\n  \"timeMillis\" : 1493121664118,\n  \"thread\" : \"main\",\n  \"threadId\" : 1,\n  \"threadPriority\" : 5,\n  \"level\" : \"INFO\",\n  \"loggerName\" : \"HelloWorld\",\n  \"marker\" : {\n    \"name\" : \"child\",\n    \"parents\" : [ {\n      \"name\" : \"parent\",\n      \"parents\" : [ {\n        \"name\" : \"grandparent\"\n      } ]\n    } ]\n  },\n  \"message\" : \"Hello, world!\",\n  \"thrown\" : {\n    \"commonElementCount\" : 0,\n    \"message\" : \"error message\",\n    \"name\" : \"java.lang.RuntimeException\",\n    \"extendedStackTrace\" : [ {\n      \"clas\"[truncated 482 bytes]; line: 6, column: 13] (through reference chain: org.apache.logging.log4j.core.impl.Log4jLogEvent[\"level\"])\n</code></pre></div>\n<h3 dir=\"auto\">parsing pseudo code</h3>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"import org.apache.logging.log4j.core.LogEvent;\nimport org.apache.logging.log4j.core.parser.LogEventParser;\nimport org.apache.logging.log4j.core.parser.JsonLogEventParser;\nimport java.nio.charset.StandardCharsets;\n\nLogEventParser parser = new JsonLogEventParser();\nLogEvent result = parser.parseFrom(inputString.getBytes(StandardCharsets.UTF_8));\nassert result != null;\"><pre><span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">logging</span>.<span class=\"pl-s1\">log4j</span>.<span class=\"pl-s1\">core</span>.<span class=\"pl-s1\">LogEvent</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">logging</span>.<span class=\"pl-s1\">log4j</span>.<span class=\"pl-s1\">core</span>.<span class=\"pl-s1\">parser</span>.<span class=\"pl-s1\">LogEventParser</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">logging</span>.<span class=\"pl-s1\">log4j</span>.<span class=\"pl-s1\">core</span>.<span class=\"pl-s1\">parser</span>.<span class=\"pl-s1\">JsonLogEventParser</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">java</span>.<span class=\"pl-s1\">nio</span>.<span class=\"pl-s1\">charset</span>.<span class=\"pl-s1\">StandardCharsets</span>;\n\n<span class=\"pl-smi\">LogEventParser</span> <span class=\"pl-s1\">parser</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">JsonLogEventParser</span>();\n<span class=\"pl-smi\">LogEvent</span> <span class=\"pl-s1\">result</span> = <span class=\"pl-s1\">parser</span>.<span class=\"pl-en\">parseFrom</span>(<span class=\"pl-s1\">inputString</span>.<span class=\"pl-en\">getBytes</span>(<span class=\"pl-smi\">StandardCharsets</span>.<span class=\"pl-c1\">UTF_8</span>));\n<span class=\"pl-k\">assert</span> <span class=\"pl-s1\">result</span> != <span class=\"pl-c1\">null</span>;</pre></div>\n"}